#!/usr/bin/python

def legit_gen_passwd(username, salt, secretpassword):
    password = ""
    for i in range(0, 16):
        password += (ord(salt[i]) + ord(secretpassword[i])) ^ username[i]
    return password

def calc(up, u, s):
    r = (int(up, 16) ^ ord(u)) - ord(s)
    r = r & 0xff # lower 8 bits
    return "{:02x}".format(r)

def gen_passwd(username, salt, user_passwd):
    username += "\n\x00"
    salt += "\n\x00"
    secretpassword = ""
    for i in range(0, 4):
        temp = user_passwd[i*8:i*8+8]
        secretpassword += calc(temp[6:8], username[i*4], salt[i*4])
        secretpassword += calc(temp[4:6], username[i*4+1], salt[i*4+1])
        secretpassword += calc(temp[2:4], username[i*4+2], salt[i*4+2])
        secretpassword += calc(temp[0:2], username[i*4+3], salt[i*4+3])
    return secretpassword

print gen_passwd("aaaaaaaaaaaaaa", "aaaaaaaaaaaaaa", "dae7e7295caeb5ae69bfd83f9720495a")
